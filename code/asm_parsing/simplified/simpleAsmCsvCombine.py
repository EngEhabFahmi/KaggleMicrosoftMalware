from ast import literal_eval
import csv
import random
import re
import csv

import pandas as pd
if __name__ == "__main__":
    bigList = []
    unicodeDict = {}
    f = open("test_simpleASM.txt", "r")
    i = 0
    j = 0
    fieldVals = set(["fileName"])

    for line in f:
        bigList.append({})
        tup = literal_eval(line)
        fileNameMatch = re.match('s3n://.*/(\w+).asm', tup[0])
        if fileNameMatch:
            fileName = fileNameMatch.groups(1)[0]
        else:
            fileName = "error"
            print "FILE NAME ERROR"
            print tup[0]
            exit(0)

        bigList[i]["fileName"] = fileName
        for innerTup in tup[1]:
            word = innerTup[0]
            count = innerTup[1]
            numberMatch = re.match('[0-9A-F]+h', word)
            if not numberMatch:
                try:
                    asciiWord = word.encode('ascii')
                    fieldVals.add(asciiWord)
                    bigList[i][asciiWord] = count

                except UnicodeEncodeError:
                    if fileName not in unicodeDict:
                        unicodeHash = str(random.random()*1000)
                        unicodeDict[word] = unicodeHash
                    fieldVals.add(unicodeDict[word])
                    bigList[i][unicodeDict[word]] = count

        i += 1
        print i
        if i % 500 == 0:
            csvFileName = 'testSimpleASM_' + str(j) + '.csv'
            with open(csvFileName, 'w') as outputFullFile:
                dict_writer2 = csv.DictWriter(outputFullFile, fieldVals)
                dict_writer2.writeheader()
                dict_writer2.writerows(bigList)
            print str(j) + "CSV Completed "
            bigList = []
            fieldVals = set(["fileName"])
            j += 1
            i = 0

    csvFileName = 'testSimpleASM_' + str(j) + '.csv'
    with open(csvFileName, 'w') as outputFullFile:
        dict_writer2 = csv.DictWriter(outputFullFile, fieldVals)
        dict_writer2.writeheader()
        dict_writer2.writerows(bigList)
    print "Main CSV Completed "
