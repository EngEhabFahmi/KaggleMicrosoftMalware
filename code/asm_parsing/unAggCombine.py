from ast import literal_eval
import pandas as pd
import json
import codecs
import csv

if __name__ == "__main__":
    bigDict = []
    f = codecs.open("AllUnAgg/reallyALL.txt", "r", "utf-8" )
    i = 0
    j = 0
    fieldVals = set(["fileID", "totalNumSubroutines", "totalNumTokens", "_idata_sectionLines", "_rdata_sectionLines",
          "_data_sectionLines", "_text_sectionLines"])
    for line in f:
        key, val = literal_eval(line)
        bigDict.append({})
        for sectionName in val[1]:
            bigDict[i][sectionName + "_sectionLines"] = val[1][sectionName]
        innerDict = val[0]

        bigDict[i]["fileID"] = key
        bigDict[i]["totalNumSubroutines"] = val[2]
        bigDict[i]["totalNumTokens"] = val[3]
        # for innerKey in innerDict.keys():
        #     innerVal = innerDict[innerKey]
        #     if innerVal > 1:
        #         bigDict[i][innerKey] = innerVal
        #         fieldVals.add(innerKey)

        i += 1
        print i
        # if i % 1000 == 0:
        #     print i
        #     #if i != 0 and i % 1000 == 0:
        #     csvFileName = 'HyperFeaturetrainUnagg_' + str(j) + '.csv'
        #     # headerName = "header_" + str(j) + '.csv'
        #
        #     # with open(headerName, 'w') as outputHeaderFile:
        #     #     dict_writer1 = csv.DictWriter(outputHeaderFile, fieldVals)
        #
        #
        #     with open(csvFileName, 'w') as outputFullFile:
        #         dict_writer2 = csv.DictWriter(outputFullFile, fieldVals)
        #         dict_writer2.writeheader()
        #         dict_writer2.writerows(bigDict)
        #
        #     #reinitialize
        #     bigDict = []
        #     fieldVals = set(["fileID", "totalNumSubroutines", "totalNumTokens", "_idata_sectionLines", "_rdata_sectionLines",
        #   "_data_sectionLines", "_text_sectionLines"])
        #     i = 0
        #     j += 1
        #     print csvFileName + " completed: " + str(j*100) + "/10860"
    csvFileName = 'hyperFeatureTrainUnagg_.csv'
    #headerName = "header_" + str(j) + '.csv'

    # with open(headerName, 'w') as outputHeaderFile:
    #     dict_writer1 = csv.DictWriter(outputHeaderFile, fieldVals)


    with open(csvFileName, 'w') as outputFullFile:
        dict_writer2 = csv.DictWriter(outputFullFile, fieldVals)
        dict_writer2.writeheader()
        dict_writer2.writerows(bigDict)



    #df = pd.DataFrame.from_dict(bigDict, orient='index')
    #df.to_csv(csvFileName)
    #print i
    #s = pd.Series(fileNames)
    #s.to_csv("fileNames.csv")

    #fOut = open("allUnagg.json", "wb")
    #json.dump(bigDict, fOut)
    #fOut.close()
    #f.close()